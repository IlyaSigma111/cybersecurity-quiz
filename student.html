<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£—á–µ–Ω–∏–∫ - –ö–∏–±–µ—Ä –ö–∞—Ö—É—Ç</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Share Tech Mono', monospace;
            background: #0a0a0a;
            color: #0f0;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            width: 100%;
            max-width: 500px;
            background: rgba(0, 255, 0, 0.05);
            backdrop-filter: blur(20px);
            border: 2px solid #0f0;
            border-radius: 30px;
            padding: 30px;
            box-shadow: 0 0 50px rgba(0, 255, 0, 0.2);
        }
        
        .screen { display: none; }
        .screen.active { display: block; }
        
        h1 { 
            font-size: 2rem; 
            text-align: center; 
            margin-bottom: 30px;
            color: #0f0;
            text-shadow: 0 0 20px #0f0;
        }
        
        .logo { 
            font-size: 60px; 
            text-align: center; 
            margin-bottom: 20px;
            filter: drop-shadow(0 0 20px #0f0);
        }
        
        input {
            width: 100%;
            padding: 18px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #0f0;
            border-radius: 16px;
            color: #0f0;
            font-size: 1.2rem;
            font-family: 'Share Tech Mono', monospace;
            margin: 10px 0;
        }
        
        input:focus {
            outline: none;
            box-shadow: 0 0 30px #0f0;
        }
        
        .btn {
            width: 100%;
            padding: 18px;
            background: rgba(0, 255, 0, 0.1);
            border: 2px solid #0f0;
            border-radius: 16px;
            color: #0f0;
            font-size: 1.2rem;
            font-family: 'Share Tech Mono', monospace;
            cursor: pointer;
            margin: 10px 0;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: rgba(0, 255, 0, 0.2);
            box-shadow: 0 0 30px #0f0;
            transform: translateY(-2px);
        }
        
        .info-box {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #0f0;
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0, 255, 0, 0.2);
        }
        
        .info-item:last-child {
            border-bottom: none;
        }
        
        .question-header {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #0f0;
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
        }
        
        .question-text {
            font-size: 1.5rem;
            margin: 30px 0;
            text-align: center;
            line-height: 1.5;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 30px 0;
        }
        
        .option {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #0f0;
            border-radius: 16px;
            padding: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 20px;
            transition: all 0.3s;
        }
        
        .option:hover {
            background: rgba(0, 255, 0, 0.1);
            box-shadow: 0 0 20px #0f0;
            transform: translateX(5px);
        }
        
        .option.selected {
            background: rgba(0, 255, 0, 0.2);
            border-color: #fff;
        }
        
        .option-letter {
            width: 40px;
            height: 40px;
            background: #0f0;
            color: black;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 1.2rem;
        }
        
        .status {
            text-align: center;
            padding: 20px;
            margin-top: 20px;
            border-radius: 16px;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .status.correct { 
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid #0f0;
            color: #0f0;
        }
        
        .status.wrong { 
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid #ff4444;
            color: #ff4444;
        }
        
        .status.waiting {
            background: rgba(255, 255, 0, 0.1);
            border: 1px solid yellow;
            color: yellow;
        }
        
        .error {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid #ff0000;
            color: #ff0000;
            padding: 12px;
            border-radius: 12px;
            margin: 10px 0;
            text-align: center;
        }
        
        .loader {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(0, 255, 0, 0.3);
            border-top: 3px solid #0f0;
            border-radius: 50%;
            margin: 20px auto;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .player-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            font-size: 1.1rem;
        }
        
        .player-stats span {
            color: #0f0;
            font-weight: bold;
            font-size: 1.3rem;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            .question-text {
                font-size: 1.2rem;
            }
            
            .option {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –≠–ö–†–ê–ù –í–•–û–î–ê -->
        <div id="joinScreen" class="screen active">
            <div class="logo">üõ°Ô∏è</div>
            <h1>–ö–ò–ë–ï–† –ö–ê–•–£–¢</h1>
            <div id="errorContainer"></div>
            <input type="text" id="playerName" placeholder="–¢–≤–æ—ë –∏–º—è" maxlength="15">
            <input type="text" id="gameCode" placeholder="–ö–æ–¥ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã" maxlength="8" inputmode="numeric" pattern="[0-9]*">
            <button id="joinButton" class="btn">üîå –ü–û–î–ö–õ–Æ–ß–ò–¢–¨–°–Ø</button>
            <a href="index.html" class="btn" style="text-align: center;">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        </div>

        <!-- –≠–ö–†–ê–ù –û–ñ–ò–î–ê–ù–ò–Ø -->
        <div id="waitingScreen" class="screen">
            <div class="logo">‚è≥</div>
            <h2 style="text-align: center; margin-bottom: 20px;">–û–ñ–ò–î–ê–ù–ò–ï...</h2>
            <div class="loader"></div>
            <div class="info-box">
                <div class="info-item">
                    <span>–£—á–∞—Å—Ç–Ω–∏–∫:</span>
                    <strong id="displayName">-</strong>
                </div>
                <div class="info-item">
                    <span>–ö–æ–¥:</span>
                    <strong id="displayCode">-</strong>
                </div>
                <div class="info-item">
                    <span>–û—á–∫–∏:</span>
                    <strong id="displayScore">0</strong>
                </div>
            </div>
            <button onclick="leaveGame()" class="btn">üö™ –í–´–ô–¢–ò</button>
        </div>

        <!-- –≠–ö–†–ê–ù –í–û–ü–†–û–°–ê -->
        <div id="questionScreen" class="screen">
            <div class="question-header">
                <span style="color: #0f0;">–ö–ò–ë–ï–†–ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨</span>
                <span id="questionCounter">1/30</span>
            </div>
            
            <div class="question-text" id="questionText">
                –ó–∞–≥—Ä—É–∑–∫–∞ –≤–æ–ø—Ä–æ—Å–∞...
            </div>
            
            <div class="options" id="optionsContainer">
                <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –∑–∞–≥—Ä—É–∑—è—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
            
            <div class="status waiting" id="answerStatus">
                ‚è≥ –í—ã–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞
            </div>
        </div>
    </div>

    <script src="firebase-config.js"></script>
    <script>
        // ============================================
        // student.js - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
        // ============================================

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–æ–ø—Ä–æ—Å–æ–≤
        console.log("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ QUIZ_DATA:", window.QUIZ_DATA);
        
        if (!window.QUIZ_DATA) {
            document.body.innerHTML = '<div style="color:red; padding:50px; font-size:2rem;">‚ùå –û–®–ò–ë–ö–ê: –≤–æ–ø—Ä–æ—Å—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</div>';
            throw new Error("QUIZ_DATA –Ω–µ –Ω–∞–π–¥–µ–Ω");
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentGameId = null;
        let playerName = null;
        let currentQuestion = null;
        let hasAnswered = false;
        let gameListener = null;

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const joinScreen = document.getElementById('joinScreen');
        const waitingScreen = document.getElementById('waitingScreen');
        const questionScreen = document.getElementById('questionScreen');
        const joinButton = document.getElementById('joinButton');
        const errorContainer = document.getElementById('errorContainer');
        const playerNameInput = document.getElementById('playerName');
        const gameCodeInput = document.getElementById('gameCode');
        const displayName = document.getElementById('displayName');
        const displayCode = document.getElementById('displayCode');
        const displayScore = document.getElementById('displayScore');
        const questionText = document.getElementById('questionText');
        const optionsContainer = document.getElementById('optionsContainer');
        const answerStatus = document.getElementById('answerStatus');
        const questionCounter = document.getElementById('questionCounter');

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
        function showError(message) {
            errorContainer.innerHTML = `<div class="error">${message}</div>`;
            setTimeout(() => { errorContainer.innerHTML = ''; }, 3000);
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —ç–∫—Ä–∞–Ω
        function switchScreen(screenName) {
            [joinScreen, waitingScreen, questionScreen].forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenName + 'Screen').classList.add('active');
        }

        // –°–±—Ä–æ—Å–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞ (–í–ê–ñ–ù–û!)
        function resetQuestionState() {
            hasAnswered = false;
            currentQuestion = null;
            
            // –û—á–∏—Å—Ç–∏—Ç—å UI
            questionText.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ –≤–æ–ø—Ä–æ—Å–∞...';
            optionsContainer.innerHTML = '';
            
            // –°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç—É—Å –Ω–∞ –æ–∂–∏–¥–∞–Ω–∏–µ
            answerStatus.textContent = '‚è≥ –í—ã–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞';
            answerStatus.className = 'status waiting';
            
            // –£–±—Ä–∞—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –æ–ø—Ü–∏–π
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected');
            });
        }

        // –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∏–≥—Ä–µ
        function joinGame() {
            const name = playerNameInput.value.trim();
            const code = gameCodeInput.value.trim();
            
            if (!name || name.length < 2) {
                showError("–í–≤–µ–¥–∏—Ç–µ –∏–º—è (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)");
                return;
            }
            
            if (!code || code.length !== 8 || !/^\d+$/.test(code)) {
                showError("–í–≤–µ–¥–∏—Ç–µ 8 —Ü–∏—Ñ—Ä –∫–æ–¥–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã");
                return;
            }
            
            playerName = name;
            currentGameId = "game_" + code;
            
            joinButton.disabled = true;
            joinButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï...';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∏–≥—Ä—ã
            db.ref(`games/${currentGameId}`).once('value').then(snapshot => {
                if (!snapshot.exists()) {
                    throw new Error(`–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ —Å –∫–æ–¥–æ–º ${code} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`);
                }
                
                const game = snapshot.val();
                
                if (game.players && game.players[name]) {
                    throw new Error("–£—á–∞—Å—Ç–Ω–∏–∫ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ –µ—Å—Ç—å");
                }
                
                // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∏–≥—Ä–æ–∫–∞
                return db.ref(`games/${currentGameId}/players/${name}`).set({
                    name: name,
                    joined: Date.now(),
                    score: 0,
                    device: /Mobi|Android/i.test(navigator.userAgent) ? "üì± –¢–µ–ª–µ—Ñ–æ–Ω" : "üíª –ö–æ–º–ø—å—é—Ç–µ—Ä"
                });
            }).then(() => {
                console.log("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω –∫ –∏–≥—Ä–µ:", currentGameId);
                
                displayName.textContent = playerName;
                displayCode.textContent = code;
                
                switchScreen('waiting');
                listenToGame();
                
                joinButton.disabled = false;
                joinButton.innerHTML = 'üîå –ü–û–î–ö–õ–Æ–ß–ò–¢–¨–°–Ø';
                
            }).catch(error => {
                showError(error.message);
                joinButton.disabled = false;
                joinButton.innerHTML = 'üîå –ü–û–î–ö–õ–Æ–ß–ò–¢–¨–°–Ø';
            });
        }

        // –°–ª—É—à–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∏–≥—Ä–µ
        function listenToGame() {
            if (!currentGameId) return;
            
            // –û—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–ª—É—à–∞—Ç–µ–ª—è
            if (gameListener) {
                db.ref(`games/${currentGameId}`).off('value', gameListener);
            }
            
            gameListener = db.ref(`games/${currentGameId}`).on('value', snapshot => {
                const game = snapshot.val();
                if (!game) {
                    console.log("–ò–≥—Ä–∞ —É–¥–∞–ª–µ–Ω–∞");
                    leaveGame();
                    return;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç –∏–≥—Ä–æ–∫–∞
                if (game.players && game.players[playerName]) {
                    displayScore.textContent = game.players[playerName].score || 0;
                }
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –∏–≥—Ä—ã
                const currentQuestionId = game.currentQuestion;
                
                // –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –∞–∫—Ç–∏–≤–µ–Ω –∏ —ç—Ç–æ –Ω–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å (–Ω–µ —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π)
                if (game.status === "question_active" && currentQuestionId) {
                    
                    // –ù–∞—Ö–æ–¥–∏–º –≤–æ–ø—Ä–æ—Å –≤ –±–∞–∑–µ
                    const question = QUIZ_DATA.questions.find(q => q.id === currentQuestionId);
                    
                    if (question) {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑–º–µ–Ω–∏–ª—Å—è –ª–∏ –≤–æ–ø—Ä–æ—Å
                        if (!currentQuestion || currentQuestion.id !== question.id) {
                            console.log("üìå –ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å:", question.id);
                            
                            // –°–ë–†–ê–°–´–í–ê–ï–ú –í–°–Å –¥–ª—è –Ω–æ–≤–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
                            resetQuestionState();
                            
                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å
                            currentQuestion = question;
                            displayQuestion(question);
                        }
                    }
                }
                
                // –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è, –Ω–æ –º—ã –µ—â—ë –Ω–µ –æ—Ç–≤–µ—á–∞–ª–∏
                if (game.status === "showing_results" && !hasAnswered && currentQuestion) {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –Ω–æ –Ω–µ –º–µ–Ω—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ
                }
            });
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –≤–æ–ø—Ä–æ—Å
        function displayQuestion(question) {
            switchScreen('question');
            
            questionText.textContent = question.text;
            questionCounter.textContent = `${question.id}/30`;
            
            // –û—á–∏—â–∞–µ–º –∏ —Å–æ–∑–¥–∞—ë–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.dataset.index = index;
                optionDiv.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div>${option}</div>
                `;
                
                optionDiv.addEventListener('click', () => selectAnswer(index));
                optionsContainer.appendChild(optionDiv);
            });
            
            // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Å—Ç–∞—Ç—É—Å —Å–±—Ä–æ—à–µ–Ω
            answerStatus.textContent = '‚è≥ –í—ã–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞';
            answerStatus.className = 'status waiting';
        }

        // –í—ã–±—Ä–∞—Ç—å –æ—Ç–≤–µ—Ç
        function selectAnswer(answerIndex) {
            if (hasAnswered) {
                console.log("‚ùå –£–∂–µ –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å");
                return;
            }
            
            if (!currentQuestion || !currentGameId || !playerName) {
                console.log("‚ùå –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞");
                return;
            }
            
            hasAnswered = true;
            
            // –ü–æ–¥—Å–≤–µ—Ç–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
            document.querySelectorAll('.option').forEach((opt, idx) => {
                opt.classList.remove('selected');
                if (idx === answerIndex) {
                    opt.classList.add('selected');
                }
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å
            const isCorrect = (answerIndex === currentQuestion.correct);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –≤ Firebase
            db.ref(`games/${currentGameId}/answers/${currentQuestion.id}/${playerName}`).set({
                answerIndex: answerIndex,
                isCorrect: isCorrect,
                timestamp: Date.now()
            }).then(() => {
                // –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç
                if (isCorrect) {
                    db.ref(`games/${currentGameId}/players/${playerName}/score`).transaction(score => {
                        return (score || 0) + (currentQuestion.points || 1);
                    });
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
                answerStatus.textContent = isCorrect ? "‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û!" : "‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û";
                answerStatus.className = isCorrect ? "status correct" : "status wrong";
                
                console.log(`üìä –û—Ç–≤–µ—Ç: ${isCorrect ? '‚úÖ' : '‚ùå'}`);
                
            }).catch(error => {
                console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞:", error);
                showError("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–≤–µ—Ç–∞");
                hasAnswered = false; // –†–∞–∑—Ä–µ—à–∏—Ç—å –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
            });
        }

        // –í—ã–π—Ç–∏ –∏–∑ –∏–≥—Ä—ã
        function leaveGame() {
            if (currentGameId && playerName) {
                db.ref(`games/${currentGameId}/players/${playerName}`).remove();
            }
            
            // –û—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç —Å–ª—É—à–∞—Ç–µ–ª—è
            if (gameListener && currentGameId) {
                db.ref(`games/${currentGameId}`).off('value', gameListener);
            }
            
            // –°–±—Ä–æ—Å–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
            currentGameId = null;
            playerName = null;
            currentQuestion = null;
            hasAnswered = false;
            gameListener = null;
            
            // –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª—è –≤–≤–æ–¥–∞
            playerNameInput.value = '';
            gameCodeInput.value = '';
            
            // –°–±—Ä–æ—Å–∏—Ç—å UI –≤–æ–ø—Ä–æ—Å–∞
            resetQuestionState();
            
            // –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞
            switchScreen('join');
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞ –∫–æ–¥–∞
        gameCodeInput.addEventListener('input', function() {
            this.value = this.value.replace(/\D/g, '').substring(0, 8);
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Enter
        playerNameInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                gameCodeInput.focus();
            }
        });

        gameCodeInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                joinGame();
            }
        });

        // –ö–Ω–æ–ø–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        joinButton.addEventListener('click', joinGame);

        // –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π
        window.leaveGame = leaveGame;
        window.selectAnswer = selectAnswer;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            console.log("‚úÖ Student panel –∑–∞–≥—Ä—É–∂–µ–Ω");
            playerNameInput.focus();
        });
    </script>
</body>
</html>
